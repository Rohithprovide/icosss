<!DOCTYPE html>
<html lang="en" data-bs-theme="light">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{% block title %}Data Collection App{% endblock %}</title>
    
    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <!-- Google Fonts - Dancing Script -->
    <link href="https://fonts.googleapis.com/css2?family=Dancing+Script:wght@400;500;600;700&display=swap" rel="stylesheet">
    
    <!-- Custom CSS -->
    <link href="{{ url_for('static', filename='css/styles.css') }}" rel="stylesheet">
</head>
<body class="d-flex align-items-center justify-content-center min-vh-100">
    <!-- Flash Messages -->
    {% with messages = get_flashed_messages(with_categories=true) %}
        {% if messages %}
            <div class="position-fixed top-0 start-50 translate-middle-x mt-3" style="z-index: 1050;">
                {% for category, message in messages %}
                    <div class="alert alert-{{ 'danger' if category == 'error' else category }} alert-dismissible fade show" role="alert">
                        {{ message }}
                        <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
                    </div>
                {% endfor %}
            </div>
        {% endif %}
    {% endwith %}

    <!-- Main Content -->
    <main class="container">
        {% block content %}{% endblock %}
    </main>

    <!-- Bootstrap JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    
    <!-- Autocomplete JavaScript -->
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const searchInput = document.getElementById('search-input');
            const dropdown = document.getElementById('autocomplete-dropdown');
            const searchContainer = document.querySelector('.search-container');
            let currentFocus = -1;
            let debounceTimeout;
            
            if (!searchInput || !dropdown) return;
            
            // Handle input events
            searchInput.addEventListener('input', function() {
                const query = this.value.trim();
                
                clearTimeout(debounceTimeout);
                
                if (query.length === 0) {
                    hideDropdown();
                    return;
                }
                
                debounceTimeout = setTimeout(() => {
                    fetchSuggestions(query);
                }, 200);
            });
            
            // Handle keyboard navigation
            searchInput.addEventListener('keydown', function(e) {
                const items = dropdown.querySelectorAll('.autocomplete-item');
                
                if (e.key === 'ArrowDown') {
                    e.preventDefault();
                    currentFocus++;
                    if (currentFocus >= items.length) currentFocus = 0;
                    setActive(items);
                } else if (e.key === 'ArrowUp') {
                    e.preventDefault();
                    currentFocus--;
                    if (currentFocus < 0) currentFocus = items.length - 1;
                    setActive(items);
                } else if (e.key === 'Enter') {
                    if (currentFocus > -1 && items[currentFocus]) {
                        e.preventDefault();
                        selectSuggestion(items[currentFocus].textContent);
                    }
                } else if (e.key === 'Escape') {
                    hideDropdown();
                }
            });
            
            // Hide dropdown when clicking outside
            document.addEventListener('click', function(e) {
                if (!searchContainer.contains(e.target)) {
                    hideDropdown();
                }
            });
            
            // Popular search suggestions database
            const suggestions = [
                'apple', 'amazon', 'android', 'art', 'anime', 'africa', 'australia', 'america',
                'bitcoin', 'bootstrap', 'business', 'blog', 'books', 'beauty', 'basketball', 'beach',
                'climate', 'covid', 'cars', 'cats', 'cooking', 'computer', 'culture', 'china',
                'dogs', 'design', 'data', 'diet', 'dance', 'doctor', 'download', 'disney',
                'education', 'email', 'exercise', 'europe', 'environment', 'entertainment', 'economy',
                'facebook', 'fitness', 'food', 'fashion', 'finance', 'football', 'free', 'fun',
                'google', 'games', 'github', 'guitar', 'golf', 'gym', 'government', 'global',
                'health', 'home', 'history', 'hotels', 'html', 'happiness', 'holidays', 'help',
                'instagram', 'internet', 'investment', 'india', 'italy', 'ios', 'iphone', 'ideas',
                'javascript', 'jobs', 'java', 'japan', 'journey', 'jokes', 'jewelry', 'justice',
                'korea', 'kitchen', 'kids', 'knowledge', 'kubernetes', 'kindle', 'karate', 'key',
                'love', 'learn', 'london', 'life', 'language', 'laptop', 'linux', 'library',
                'music', 'movies', 'money', 'mobile', 'medicine', 'math', 'marketing', 'marvel',
                'news', 'netflix', 'nature', 'nutrition', 'nodejs', 'network', 'nasa', 'new york',
                'online', 'ocean', 'office', 'open source', 'olympics', 'outdoor', 'origin', 'order',
                'python', 'programming', 'pizza', 'photography', 'phone', 'paris', 'pets', 'people',
                'quotes', 'quantum', 'quality', 'question', 'quiz', 'quick', 'quest', 'queen',
                'react', 'recipes', 'reading', 'reddit', 'running', 'restaurants', 'research', 'robots',
                'sports', 'science', 'school', 'software', 'shopping', 'social', 'samsung', 'space',
                'technology', 'travel', 'twitter', 'tutorials', 'tesla', 'time', 'tips', 'tools',
                'university', 'usa', 'ubuntu', 'united', 'update', 'upload', 'urban', 'user',
                'video', 'vacation', 'virtual', 'vision', 'voice', 'vitamins', 'vehicles', 'value',
                'weather', 'web', 'windows', 'work', 'world', 'writing', 'wifi', 'website',
                'xbox', 'xcode', 'xml', 'xray', 'xenon', 'xerox', 'xmas', 'xperia',
                'youtube', 'yoga', 'year', 'young', 'yahoo', 'yellow', 'yummy', 'yesterday',
                'zoom', 'zero', 'zone', 'zip', 'zombie', 'zodiac', 'zucchini', 'zen'
            ];
            
            function fetchSuggestions(query) {
                const lowerQuery = query.toLowerCase();
                const matches = suggestions.filter(item => 
                    item.toLowerCase().startsWith(lowerQuery)
                ).slice(0, 8);
                
                // Also add exact query if it's not already in matches
                if (!matches.includes(query) && query.length > 0) {
                    matches.unshift(query);
                    matches.splice(8); // Keep only 8 items
                }
                
                showSuggestions(matches);
            }
            
            function showSuggestions(suggestions) {
                dropdown.innerHTML = '';
                currentFocus = -1;
                
                if (!suggestions || suggestions.length === 0) {
                    hideDropdown();
                    return;
                }
                
                suggestions.forEach(function(suggestion) {
                    const item = document.createElement('div');
                    item.className = 'autocomplete-item';
                    item.textContent = suggestion;
                    
                    item.addEventListener('click', function() {
                        selectSuggestion(suggestion);
                    });
                    
                    dropdown.appendChild(item);
                });
                
                searchContainer.classList.add('has-suggestions');
                dropdown.classList.add('show');
            }
            
            function hideDropdown() {
                dropdown.classList.remove('show');
                searchContainer.classList.remove('has-suggestions');
                currentFocus = -1;
            }
            
            function selectSuggestion(suggestion) {
                searchInput.value = suggestion;
                hideDropdown();
                searchInput.focus();
            }
            
            function setActive(items) {
                items.forEach(function(item, index) {
                    if (index === currentFocus) {
                        item.classList.add('highlighted');
                    } else {
                        item.classList.remove('highlighted');
                    }
                });
            }
        });
    </script>
</body>
</html>
